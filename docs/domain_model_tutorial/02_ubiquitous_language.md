# ステップ2: ユビキタス言語

## 学習目標

- ユビキタス言語の定義と重要性を理解する
- 良いユビキタス言語を見分けられるようになる
- オクト対戦ゲームでのユビキタス言語を理解する

---

## 2.1 ユビキタス言語とは

**ユビキタス言語（Ubiquitous Language）** とは、**開発者とドメインエキスパートが共有する共通言語**のことです。

"Ubiquitous" は「至るにある」「遍在する」を意味します。

### 目的

- コード、ドキュメント、会話で**同じ用語**を使う
- 誤解を減らし、コミュニケーションコストを下げる
- ドメイン知識をコードに直接反映する

---

## 2.1 悪い例：用語が統一されていない

### 問題のあるコード

```typescript
// 開発者は「game」と呼ぶ
class GameController {
  startGame(gameId: number) { ... }
}

// ドメインエキスパートは「対局」と呼ぶ
// 設計書では「マッチ」と呼ぶ
// データベースでは「battle」というテーブル名
```

この状態の問題点：
- 「game」「対局」「マッチ」「battle」が同じものを指すのか不明
- 新しいメンバーが参加したとき、どの用語を使えばいいか迷う
- コードを読むだけではビジネス上の意味が汲み取りにくい

---

## 2.2 良い例：ユビキタス言語の適用

### 統一された用語

```typescript
// 全てのレイヤーで「部屋（Room）」という用語を使用

// エンティティ
class Room {
  start(): void { ... }
}

// リポジトリ
interface RoomRepository {
  findById(id: RoomId): Promise<Room | null>;
}

// API
POST /api/rooms
GET /api/rooms/:id

// データベース
Table: rooms

// ドキュメント
「部屋を作成すると、プレイヤーは部屋に参加します...」
```

「部屋」という単語がコード、API、DB、ドキュメントで一貫して使われています。

---

## 2.3 ユビキタス言語の作り方

### ステップ1: 用語のリストアップ

開発者とドメインエキスパートが一緒にブレインストーミング：

| 提案された用語 | 出典 |
|--------------|------|
| ゲーム、対局、マッチ、部屋、セッション | 開発者からの提案 |
| 対戦、試合、ゲーム | プランナーからの提案 |

### ステップ2: 定義の合意

「同じ概念を指す用語」を1つに絞り込みます。

### ステップ3: 用語集の作成

決定した用語をドキュメント化します。

---

## 2.4 オクト対戦ゲームのユビキタス言語

`../domain_model.md` の第1章「ユビキタス言語」で定義されている用語：

| 用語 | 説明 | 採用理由 |
|------|------|---------|
| **部屋 (Room)** | 対戦セッション | 「セッション」は技術的すぎる。「ゲーム」は動作も指すため曖昧。「部屋」は対戦待機から終了までを含む概念として適切 |
| **参加者 (Participant)** | 部屋に参加し特定の色を担当するプレイヤー | 「プレイヤー」はユーザー全体を指すため、「参加者」で区別 |
| **着手 (Move)** | 特定の座標に石を置く行為 | 「手」「打つ」も使われるが、「着手」が最も一般的 |
| **盤面 (Board)** | 8×8のマス目と配置された石の状態 | ボードゲームの標準用語 |
| **ライン (Line)** | 縦・横・斜めの8マス連続する位置の集合 | オクト独自の勝利条件を表すため必要な用語 |
| **パス (Pass)** | 合法手が存在しない場合のスキップ | オセロ/オクトの標準用語 |

---

## 2.5 用語集のベストプラクティス

### ✅ 良い用語の特徴

| 特徴 | 例 |
|------|------|
| ドメインエキスパートが自然に使う | 「部屋に入る」「パスする」 |
| 技術的なニュアンスが含まれない | 「セッション」× → 「部屋」○ |
| 単一の責任を持つ | 「ゲーム」は動作も名詞も指すので曖昧 |

### ❌ 避けるべきこと

- 技術用語をそのまま使う（DTO、Entity、DAO 等）
- 略語を使いすぎる（Room、User はOKだが、Prt、Mv 等は不可）
- 複数の言語を混ぜる（日本語と英語を混ぜる等）

---

## 2.6 用語がコンフリクトした場合の解決方法

### シナリオ：新機能「観戦」の追加

| 提案者 | 提案用語 | 理由 |
|--------|---------|------|
| 開発者A | Observer | Observerパターンが使えるから |
| 開発者B | Spectator | 英語圏のゲームでは一般的 |
| プランナー | 観戦者 | 日本のユーザーに分かりやすい |

### 解決策

1. **コンテキストごとの採用**を検討
   - コード内: `Spectator`（英語ベース）
   - UI表示: 「観戦者」（日本語）

2. または、**ドメインエキスパートの使用する用語**を優先
   - プランナーが「観戦者」と呼ぶなら、コードでも `Spectator` だが用語集では「観戦者」と明記

---

## 確認問題

### Q1: 以下のうち、ユビキタス言語の目的として正しいものは？

A. プログラミング言語を統一する
B. 開発者とドメインエキスパートの間で用語を統一する
C. 英語のみでコードを書くようにする
D. 用語を短縮して効率化する

<details>
<summary>回答</summary>

**正解: B**

ユビキタス言語の目的は、開発者とドメインエキスパートが同じ用語を使うことでコミュニケーションの齟齬をなくすことです。
</details>

---

### Q2: 「パス」という用語は、どのレイヤーで使用すべきか？

A. コードのみ
B. ドキュメントのみ
C. API仕様書のみ
D. コード、ドキュメント、API全て

<details>
<summary>回答</summary>

**正解: D**

ユビキタス言語は全てのレイヤーで統一して使用します。コード、ドキュメント、API、データベース、会話全てで同じ用語を使います。
</details>

---

## 次のステップ

[バウンデッドコンテキスト](./03_bounded_context.md) → システムをどのように分割するかを学びます。
