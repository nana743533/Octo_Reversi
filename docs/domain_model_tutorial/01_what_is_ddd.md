# ステップ1: DDDとは何か

## 学習目標

- ドメイン駆動設計（DDD）の概要を理解する
- なぜDDDが必要なのかを理解する
- DDDの基本用語を知る

---

## 1.1 DDDの定義

ドメイン駆動設計（Domain-Driven Design: DDD）は、**ソフトウェアの複雑性を管理するためのソフトウェア開発手法**です。

Eric Evans が2003年の著書『Domain-Driven Design』で提唱しました。

### キーポイント

> **ドメイン** = ソフトウェアを適用する対象となる業務領域
>
> 例：ECサイトなら「商品管理」「注文処理」「在庫管理」などがドメイン

DDDは、技術的な関心ではなく**業務領域（ドメイン）の関心**を中心にソフトウェアを設計します。

---

## 1.2 なぜDDDが必要なのか

### 問題：技術中心の設計の弊害

```typescript
// 悪い例：技術中心の設計
class DataController {
  async updateData(table: string, id: number, data: any) {
    // 「何のためにデータを更新するのか」が不明
    await db.update(table, id, data);
  }
}

// メソッド名だけ見ても、ビジネス上の意味が伝わらない
await updateData('rooms', 123, { status: 'playing' });
```

このコードの問題点：
- `rooms` が何を表すのか不明
- `status` がどのような状態遷移を持つのか不明
- `'playing'` になるための前提条件が不明

### 解決：ドメイン中心の設計

```typescript
// 良い例：ドメイン中心の設計
class Room {
  start(): void {
    if (this.participants.length !== 2) {
      throw new Error("2人揃っていないと開始できません");
    }
    if (this.status !== RoomStatus.WAITING) {
      throw new Error("既に開始または終了しています");
    }
    this.status = RoomStatus.PLAYING;
  }
}

// ビジネス上の意味が明確
room.start();
```

ドメインのルールがコードに明示されています。

---

## 1.3 DDDの基本用語

### 戦略的デザイン（システム全体の構造）

| 用語 | 説明 |
|------|------|
| **ドメイン** | ソフトウェアが解決すべき業務領域 |
| **サブドメイン** | ドメインを分割した smaller な領域 |
| **ユビキタス言語** | チーム内で統一された共通言語 |
| **バウンデッドコンテキスト** | 特定のモデルが適用される境界 |
| **コンテキストマップ** | 複数のコンテキスト間の関係図 |

### 戦術的デザイン（コードレベルのパターン）

| 用語 | 説明 |
|------|------|
| **エンティティ** | IDで識別されるオブジェクト |
| **値オブジェクト** | 属性値で識別される不変オブジェクト |
| **集約** | データ整合性を保つために一括操作するオブジェクト群 |
| **ドメインサービス** | エンティティ/値オブジェクトに属さないドメインロジック |
| **リポジトリ** | 集約の永続化と再構築を担当 |
| **ドメインイベント** | ドメイン内で発生した出来事を表すイベント |

---

## 1.4 DDDの適用が効果的なケース

### ✅ 適しているケース

- 複雑なビジネスルールがある
- ビジネスロジックが頻繁に変更される
- チーム内のコミュニケーションコストが高い
- 長期的にメンテナンスが必要なシステム

### ❌ 向いていないケース

- 単純なCRUDのみのシステム
- ビジネスロジックがほとんどない
- 短期的なプロトタイプ

---

## 1.5 オクト対戦ゲームでの適用例

オクト対戦ゲームのドメイン構造：

```
オクト対戦ゲーム（ドメイン）
│
├── マッチングサブドメイン
│   └── 「プレイヤーをマッチングする」
│
├── ゲームプレイサブドメイン
│   └── 「対戦を進行・判定する」
│
└── ユーザーサブドメイン
    └── 「プレイヤーを管理する」
```

DDDを適用することで：
- 「オクトのルール」がコードに明確に表現される
- ルール変更（例：新しい勝利条件の追加）に柔軟に対応できる
- 開発者とステークホルダーの会話がスムーズになる

---

## 確認問題

### Q1: 以下のうち、ドメイン駆動設計の目的として最も適切なものは？

A. データベースの設計を最適化する
B. 技術的な関心ではなく業務領域の関心を中心に設計する
C. コードの行数を減らす
D. 特定のフレームワークに依存しない設計にする

<details>
<summary>回答</summary>

**正解: B**

DDDは技術的な実装詳細よりも、ビジネスドメインの知識をモデル化し、コードに反映することに重点を置きます。
</details>

---

### Q2: オクト対戦ゲームにおいて、「パス」という概念はどのカテゴリに属するか？

A. 技術的な実装詳細
B. ビジネスルール（ドメイン知識）
C. データベース設計
D. フレームワークの機能

<details>
<summary>回答</summary>

**正解: B**

「パス」はオクト（およびオセロ）のゲームルールにおける重要な概念であり、ビジネスルール（ドメイン知識）です。DDDではこのようなドメイン知識をコードに明示的に表現します。
</details>

---

## 次のステップ

[ユビキタス言語](./02_ubiquitous_language.md) → チーム内で統一された言語を定義する方法を学びます。
